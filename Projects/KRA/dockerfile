# Use a lightweight Python base image
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Copy generic script
COPY kra_script.py ./kra.py

# Copy specific KRA folder (this will be dynamically adjusted during the build)
ARG KRA_DIR=kra1
COPY ${KRA_DIR}/keys ./keys/

# Install required Python libraries
RUN pip install --no-cache-dir cryptography

# Set environment variables dynamically
ENV PRIVATE_KEY_PATH=./keys/kra1_private.pem \
    PUBLIC_KEY_PATH=./keys/krc_public.pem \
    LISTEN_PORT=5003

# Expose port dynamically
EXPOSE ${LISTEN_PORT}

# Run the KRA script
CMD ["python", "./kra.py"]
